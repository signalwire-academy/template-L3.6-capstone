name: Grade Lab

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  grade:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      checks: write
      issues: write

    steps:
      - uses: actions/checkout@v4

      - name: Grade lab
        id: grade
        uses: signalwire-academy/swaig-grader@v1
        with:
          solution-file: solution/agent.py

      - name: Notify progress tracker
        if: always()
        continue-on-error: true
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.PROGRESS_TOKEN }}
          repository: signalwire-academy/progress-tracker
          event-type: grading-complete
          client-payload: '{"repo": "${{ github.repository }}", "student": "${{ github.repository_owner }}", "lab": "L3.6", "result": "${{ steps.grade.outcome }}", "sha": "${{ github.sha }}"}'
